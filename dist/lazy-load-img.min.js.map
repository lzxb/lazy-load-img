{"version":3,"file":null,"sources":["../src/lib/testMeet.js","../src/lib/get-transparent.js","../src/index.js"],"sourcesContent":["export default function (el, options = {}) {\n  // 取得元素在可视区的位置（相对浏览器视窗）左右上下\n  var bcr = el.getBoundingClientRect()\n  // padding+border+width\n  var mw = el.offsetWidth // 元素自身宽度\n  var mh = el.offsetHeight // 元素自身的高度\n  // 包含了导航栏\n  var w = window.innerWidth // 视窗的宽度\n  var h = window.innerHeight // 视窗的高度\n\n  var boolX = (!((bcr.right - options.left) <= 0 && ((bcr.left + mw) - options.left) <= 0) && !((bcr.left + options.right) >= w && (bcr.right + options.right) >= (mw + w))) // 左右符合条件\n  var boolY = (!((bcr.bottom - options.top) <= 0 && ((bcr.top + mh) - options.top) <= 0) && !((bcr.top + options.bottom) >= h && (bcr.bottom + options.bottom) >= (mh + h))) // 上下符合条件\n  return el.width !== 0 && el.height !== 0 && boolX && boolY\n}\n","export default class GetTransparent {\n  constructor () {\n    this.images = {}\n    this.canvas = document.createElement('canvas')\n    this.canvas.getContext('2d').globalAlpha = 0.0\n  }\n  toBase64 (src, w, h) {\n    if (this.images[src]) return this.images[src]\n    this.canvas.width = w\n    this.canvas.height = h\n    var data = this.canvas.toDataURL('image/png')\n    this.images[src] = data\n    return data\n  }\n  destroy () {\n    this.images = null\n    this.canvas = null\n  }\n}\n","import testMeet from './lib/testMeet'\nimport GetTransparent from './lib/get-transparent'\n\nclass LazyLoadImg {\n  // 构造函数 初始化参数\n  constructor (options = {}) {\n    this.options = {\n      el: document.querySelector('body'), // 选择的元素\n      mode: 'default', // 默认模式，将显示原图，diy模式，将自定义剪切，默认剪切居中部分\n      time: 300, // 设置一个检测时间间隔\n      done: true, // 页面内所有数据图片加载完成后，是否自己销毁程序，true默认销毁，false不销毁：FALSE应用场景：页面异步不断获取数据的情况下 需要实时监听则不销毁\n      diy: { // 此属性，只有在设置diy 模式时才生效\n        backgroundSize: 'cover',\n        backgroundRepeat: 'no-repeat',\n        backgroundPosition: 'center center'\n      },\n      position: { // 只要其中一个位置符合条件，都会触发加载机制\n        top: 0, // 元素距离顶部\n        right: 0, // 元素距离右边\n        bottom: 0, // 元素距离下面\n        left: 0 // 元素距离左边\n      },\n      before (el) { // 图片加载之前，执行钩子函数\n\n      },\n      success (el) { // 图片加载成功，执行钩子函数\n\n      },\n      error (el) { // 图片加载失败，执行的钩子函数\n\n      }\n    }\n    // 深拷贝 如果都有 则右面的值 option.position会覆盖this.options.position\n    options.position = Object.assign({}, this.options.position, options.position)\n    options.diy = Object.assign({}, this.options.diy, options.diy)\n    Object.assign(this.options, options)\n    this._getTransparent = new GetTransparent()\n    this.start()\n  }\n  start () {\n    this._timer = true\n    this._start()\n  }\n  _start () {\n    var { options } = this\n    clearTimeout(this._timer) // 清除定时器\n    if (!this._timer) return\n    this._timer = setTimeout(() => {\n      var list = Array.prototype.slice.apply(options.el.querySelectorAll('[data-src]'))\n      if (!list.length && options.done) return clearTimeout(this._timer)\n      list.forEach((el) => {\n        if (!el.dataset.LazyLoadImgState && testMeet(el, options.position)) {\n          this.loadImg(el)\n        }\n      })\n      this._start()\n    }, options.time)\n  }\n  loadImg (el) { // 加载图片\n    var { options } = this\n    el.dataset.LazyLoadImgState = 'start'\n    options.before.call(this, el)\n    var img = new window.Image()\n    img.src = el.dataset.src\n    // 图片加载成功\n    img.addEventListener('load', () => {\n      if (options.mode === 'diy') {\n        el.src = this._getTransparent.toBase64(el.src, el.width, el.height)\n        options.diy.backgroundImage = 'url(' + img.src + ')'\n        Object.assign(el.style, options.diy)\n      } else {\n        el.src = img.src\n      }\n      delete el.dataset.src\n      delete el.dataset.LazyLoadImgState\n      return options.success.call(this, el)\n    }, false)\n\n    // 图片加载失败\n    img.addEventListener('error', () => {\n      delete el.dataset.src\n      delete el.dataset.LazyLoadImgState\n      options.error.call(this, el)\n    }, false)\n  }\n  destroy () { // 解除事件绑定\n    delete this._timer\n    this._getTransparent.destroy()\n  }\n}\nexport default LazyLoadImg\n"],"names":["el","options","bcr","getBoundingClientRect","mw","offsetWidth","mh","offsetHeight","w","window","innerWidth","h","innerHeight","boolX","right","left","boolY","bottom","top","width","height","GetTransparent","images","canvas","document","createElement","getContext","globalAlpha","src","this","data","toDataURL","querySelector","position","babelHelpers.extends","diy","_getTransparent","start","_timer","_start","setTimeout","list","Array","prototype","slice","apply","querySelectorAll","length","done","clearTimeout","_this","forEach","dataset","LazyLoadImgState","testMeet","loadImg","time","before","call","img","Image","addEventListener","mode","_this2","toBase64","backgroundImage","style","success","error","destroy"],"mappings":"sLAAA,OAAe,SAAUA,MAAIC,6DAEvBC,EAAMF,EAAGG,wBAETC,EAAKJ,EAAGK,YACRC,EAAKN,EAAGO,aAERC,EAAIC,OAAOC,WACXC,EAAIF,OAAOG,YAEXC,IAAYX,EAAIY,MAAQb,EAAQc,MAAS,GAAOb,EAAIa,KAAOX,EAAMH,EAAQc,MAAS,GAASb,EAAIa,KAAOd,EAAQa,OAAUN,GAAMN,EAAIY,MAAQb,EAAQa,OAAWV,EAAKI,GAClKQ,IAAYd,EAAIe,OAAShB,EAAQiB,KAAQ,GAAOhB,EAAIgB,IAAMZ,EAAML,EAAQiB,KAAQ,GAAShB,EAAIgB,IAAMjB,EAAQgB,QAAWN,GAAMT,EAAIe,OAAShB,EAAQgB,QAAYX,EAAKK,SAClJ,KAAbX,EAAGmB,OAA6B,IAAdnB,EAAGoB,QAAgBP,GAASG,2fCZlCK,yCAEZC,eACAC,OAASC,SAASC,cAAc,eAChCF,OAAOG,WAAW,MAAMC,YAAc,6CAEnCC,EAAKpB,EAAGG,MACZkB,KAAKP,OAAOM,GAAM,MAAOC,MAAKP,OAAOM,QACpCL,OAAOJ,MAAQX,OACfe,OAAOH,OAAST,KACjBmB,GAAOD,KAAKN,OAAOQ,UAAU,yBAC5BT,OAAOM,GAAOE,EACZA,yCAGFR,OAAS,UACTC,OAAS,gDCXHtB,4EACNA,YACCuB,SAASQ,cAAc,aACrB,eACA,UACA,sBAEY,yBACE,+BACE,+BAGf,QACE,SACC,OACF,mBAEAhC,sBAGCA,oBAGFA,QAKDiC,SAAWC,KAAkBL,KAAK5B,QAAQgC,SAAUhC,EAAQgC,YAC5DE,IAAMD,KAAkBL,KAAK5B,QAAQkC,IAAKlC,EAAQkC,OAC5CN,KAAK5B,QAASA,QACvBmC,gBAAkB,GAAIf,QACtBgB,uDAGAC,QAAS,OACTC,qDAGCtC,EAAY4B,KAAZ5B,qBACO4B,KAAKS,QACbT,KAAKS,cACLA,OAASE,WAAW,cACnBC,GAAOC,MAAMC,UAAUC,MAAMC,MAAM5C,EAAQD,GAAG8C,iBAAiB,mBAC9DL,EAAKM,QAAU9C,EAAQ+C,KAAM,MAAOC,cAAaC,EAAKZ,UACtDa,QAAQ,SAACnD,IACPA,EAAGoD,QAAQC,kBAAoBC,EAAStD,EAAIC,EAAQgC,aAClDsB,QAAQvD,OAGZuC,UACJtC,EAAQuD,uCAEJxD,cACDC,EAAY4B,KAAZ5B,UACHmD,QAAQC,iBAAmB,UACtBI,OAAOC,KAAK7B,KAAM7B,MACtB2D,GAAM,GAAIlD,QAAOmD,QACjBhC,IAAM5B,EAAGoD,QAAQxB,MAEjBiC,iBAAiB,OAAQ,iBACN,QAAjB5D,EAAQ6D,QACPlC,IAAMmC,EAAK3B,gBAAgB4B,SAAShE,EAAG4B,IAAK5B,EAAGmB,MAAOnB,EAAGoB,UACpDe,IAAI8B,gBAAkB,OAASN,EAAI/B,IAAM,MACnC5B,EAAGkE,MAAOjE,EAAQkC,QAE7BP,IAAM+B,EAAI/B,UAER5B,GAAGoD,QAAQxB,UACX5B,GAAGoD,QAAQC,iBACXpD,EAAQkE,QAAQT,KAAKK,EAAM/D,KACjC,KAGC6D,iBAAiB,QAAS,iBACrB7D,GAAGoD,QAAQxB,UACX5B,GAAGoD,QAAQC,mBACVe,MAAMV,KAAKK,EAAM/D,KACxB,2CAGI6B,MAAKS,YACPF,gBAAgBiC"}