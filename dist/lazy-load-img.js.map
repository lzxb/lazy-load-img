{"version":3,"file":null,"sources":["../src/lib/testMeet.js","../src/lib/get-transparent.js","../src/index.js"],"sourcesContent":["export default function (el, options = {}) {\n  // 取得元素在可视区的位置（相对浏览器视窗）左右上下\n  var bcr = el.getBoundingClientRect()\n  // padding+border+width\n  var mw = el.offsetWidth // 元素自身宽度\n  var mh = el.offsetHeight // 元素自身的高度\n  // 包含了导航栏\n  var w = window.innerWidth // 视窗的宽度\n  var h = window.innerHeight // 视窗的高度\n\n  var boolX = (!((bcr.right - options.left) <= 0 && ((bcr.left + mw) - options.left) <= 0) && !((bcr.left + options.right) >= w && (bcr.right + options.right) >= (mw + w))) // 左右符合条件\n  var boolY = (!((bcr.bottom - options.top) <= 0 && ((bcr.top + mh) - options.top) <= 0) && !((bcr.top + options.bottom) >= h && (bcr.bottom + options.bottom) >= (mh + h))) // 上下符合条件\n  return el.width !== 0 && el.height !== 0 && boolX && boolY\n}\n","export default class GetTransparent {\n  constructor () {\n    this.images = {}\n    this.canvas = document.createElement('canvas')\n    this.canvas.getContext('2d').globalAlpha = 0.0\n  }\n  toBase64 (src, w, h) {\n    if (this.images[src]) return this.images[src]\n    this.canvas.width = w\n    this.canvas.height = h\n    var data = this.canvas.toDataURL('image/png')\n    this.images[src] = data\n    return data\n  }\n  destroy () {\n    this.images = null\n    this.canvas = null\n  }\n}\n","import testMeet from './lib/testMeet'\nimport GetTransparent from './lib/get-transparent'\n\nclass LazyLoadImg {\n  // 构造函数 初始化参数\n  constructor (options = {}) {\n    this.options = {\n      el: document.querySelector('body'), // 选择的元素\n      mode: 'default', // 默认模式，将显示原图，diy模式，将自定义剪切，默认剪切居中部分\n      time: 300, // 设置一个检测时间间隔\n      done: true, // 页面内所有数据图片加载完成后，是否自己销毁程序，true默认销毁，false不销毁：FALSE应用场景：页面异步不断获取数据的情况下 需要实时监听则不销毁\n      diy: { // 此属性，只有在设置diy 模式时才生效\n        backgroundSize: 'cover',\n        backgroundRepeat: 'no-repeat',\n        backgroundPosition: 'center center'\n      },\n      position: { // 只要其中一个位置符合条件，都会触发加载机制\n        top: 0, // 元素距离顶部\n        right: 0, // 元素距离右边\n        bottom: 0, // 元素距离下面\n        left: 0 // 元素距离左边\n      },\n      before (el) { // 图片加载之前，执行钩子函数\n\n      },\n      success (el) { // 图片加载成功，执行钩子函数\n\n      },\n      error (el) { // 图片加载失败，执行的钩子函数\n\n      }\n    }\n    // 深拷贝 如果都有 则右面的值 option.position会覆盖this.options.position\n    options.position = Object.assign({}, this.options.position, options.position)\n    options.diy = Object.assign({}, this.options.diy, options.diy)\n    Object.assign(this.options, options)\n    this._getTransparent = new GetTransparent()\n    this.start()\n  }\n  start () {\n    this._timer = true\n    this._start()\n  }\n  _start () {\n    var { options } = this\n    clearTimeout(this._timer) // 清除定时器\n    if (!this._timer) return\n    this._timer = setTimeout(() => {\n      var list = Array.prototype.slice.apply(options.el.querySelectorAll('[data-src]'))\n      if (!list.length && options.done) return clearTimeout(this._timer)\n      list.forEach((el) => {\n        if (!el.dataset.LazyLoadImgState && testMeet(el, options.position)) {\n          this.loadImg(el)\n        }\n      })\n      this._start()\n    }, options.time)\n  }\n  loadImg (el) { // 加载图片\n    var { options } = this\n    el.dataset.LazyLoadImgState = 'start'\n    options.before.call(this, el)\n    var img = new window.Image()\n    img.src = el.dataset.src\n    // 图片加载成功\n    img.addEventListener('load', () => {\n      if (options.mode === 'diy') {\n        el.src = this._getTransparent.toBase64(el.src, el.width, el.height)\n        options.diy.backgroundImage = 'url(' + img.src + ')'\n        Object.assign(el.style, options.diy)\n      } else {\n        el.src = img.src\n      }\n      delete el.dataset.src\n      delete el.dataset.LazyLoadImgState\n      return options.success.call(this, el)\n    }, false)\n\n    // 图片加载失败\n    img.addEventListener('error', () => {\n      delete el.dataset.src\n      delete el.dataset.LazyLoadImgState\n      options.error.call(this, el)\n    }, false)\n  }\n  destroy () { // 解除事件绑定\n    delete this._timer\n    this._getTransparent.destroy()\n  }\n}\nexport default LazyLoadImg\n"],"names":["el","options","bcr","getBoundingClientRect","mw","offsetWidth","mh","offsetHeight","w","window","innerWidth","h","innerHeight","boolX","right","left","boolY","bottom","top","width","height","GetTransparent","images","canvas","document","createElement","getContext","globalAlpha","src","data","toDataURL","LazyLoadImg","querySelector","position","babelHelpers.extends","diy","_getTransparent","start","_timer","_start","setTimeout","list","Array","prototype","slice","apply","querySelectorAll","length","done","clearTimeout","forEach","dataset","LazyLoadImgState","testMeet","loadImg","time","before","call","img","Image","addEventListener","mode","toBase64","backgroundImage","style","success","error","destroy"],"mappings":"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"}